<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <title>Dashboard</title>
    <link href="./css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="header">
      <div class="toggle">
        <a id="toggle-nav"><i class="fa fa-navicon cog"></i></a>
      </div>
    </div>
    <div class="container">
      <div class="sidebar" id="sidebar">
        <a href="dashboard.html"><i class="fa fa-home"></i> Dashboard</a>
        <a href="form.html"><i class="fa fa-shopping-cart"></i> Forms</a>
        <a href="tables.html"><i class="fa fa-shopping-bag"></i> Tables</a>
      </div>
      <div class="content">
        <div class="summary-container">
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-users"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Users</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-signal"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Products</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-shopping-cart"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Sales</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-line-chart"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Profit</div>
              <div><h2>0</h2></div>
            </div>
          </div>
        </div>
        <div class="charts-container">
          <div class="chart-card">
            <h4 class="purple">Sales Trend</h4>
            <canvas id="salesChart"></canvas>
          </div>
          <div class="chart-card">
            <h4 class="magenta">Site Visitors Last 10 Days</h4>
            <canvas id="visitorsChart"></canvas>
          </div>
          <div class="chart-card">
            <h4 class="l">Categories Trend</h4>
            <canvas id="categoriesChart"></canvas>
          </div>
          <div class="chart-card">
            <h4 class="red">Product Trend</h4>
            <canvas id="productTrendChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $("document").ready(() => {
        // Toggle sidebar
        $("#toggle-nav").click(function () {
          $("#sidebar").toggle();
        });

        
        $.get("http://localhost:3000/dash_stats", function (data) {
          $(".summary-content h2").eq(0).text(data.users);
          $(".summary-content h2").eq(1).text(data.products);
          $(".summary-content h2").eq(2).text(data.sales);
          $(".summary-content h2").eq(3).text(data.profit);
        });

      
        $.get("http://localhost:3000/sales", function (data) {
          new Chart($("#salesChart")[0].getContext("2d"), {
            type: "scatter",
            data: {
              datasets: [
                {
                  label: "Sales",
                  data: data, // directly the array
                  backgroundColor: "rgba(153, 102, 255, 0.2)",
                  borderColor: "rgba(153, 102, 255, 1)",
                },
              ],
            },
            options: {
              scales: {
                xAxes: [{ type: "linear", position: "bottom" }],
              },
            },
          });
        });

      
        $.get("http://localhost:3000/visitors", function (data) {
          new Chart($("#visitorsChart")[0].getContext("2d"), {
            type: "line",
            data: {
              labels: data.day,
              datasets: [
                {
                  label: "Visitors",
                  data: data.count,
                  borderColor: "rgb(75, 192, 192)",
                  fill: false,
                  tension: 0.1,
                },
              ],
            },
          });
        });

        
        $.get("http://localhost:3000/sold_products", function (data) {
          new Chart($("#categoriesChart")[0].getContext("2d"), {
            type: "pie",
            data: {
              labels: data.category,
              datasets: [
                {
                  data: data.count,
                  backgroundColor: [
                    "#FF6384",
                    "#36A2EB",
                    "#FFCE56",
                    "#4BC0C0",
                    "#9966FF",
                  ],
                },
              ],
            },
          });
        });

     
        $.get("http://localhost:3000/top_products", function (data) {
          new Chart($("#productTrendChart")[0].getContext("2d"), {
            type: "bar",
            data: {
              labels: data.product,
              datasets: [
                {
                  label: "Best Selling",
                  data: data.count,
                  backgroundColor: "rgba(255, 99, 132, 0.2)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              indexAxis: "y",
              scales: {
                xAxes: [{ ticks: { beginAtZero: true } }],
              },
            },
          });
        });
      });
    </script>
  </body>
</html>
