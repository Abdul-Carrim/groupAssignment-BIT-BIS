<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <title>Dashboard</title>
    <link href="./css/site.css" rel="stylesheet">
  </head>
  <body>
    <div class="header">
      <div class="toggle">
        <a id="toggle-nav"><i class="fa fa-navicon cog"></i></a>
      </div>
    </div>
    <div class="container">
      <div class="sidebar" id="sidebar">
        <a href="dashboard.html"><i class="fa fa-home"></i> Dashboard</a>
        <a href="form.html"><i class="fa fa-shopping-cart"></i> Forms</a>
        <a href="tables.html"><i class="fa fa-shopping-bag"></i> Tables</a>
      </div>
      <div class="content">
        <div class="summary-container">
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-users"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Users</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-signal"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Products</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-shopping-cart"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Sales</div>
              <div><h2>0</h2></div>
            </div>
          </div>
          <div class="summary">
            <div class="summary-icon"><i class="fa fa-line-chart"></i></div>
            <div class="summary-content">
              <div class="summary-heading">Profit</div>
              <div><h2>0</h2></div>
            </div>
          </div>
        </div>
        <div class="charts-container">
          <!-- This is the chart content section-->
          <h4>Implement here..</h4>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $("document").ready(() => {
        $("#toggle-nav").click(() => {
          $("#sidebar").toggleClass("active");
        });
      });
    </script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $("document").ready(() => {

    $("#toggle-nav").click(() => {
      $("#sidebar").toggleClass("active");
    });

    // Layout for charts
    const chartsContainer = $(".charts-container");
    chartsContainer.html(`
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;">
        <div>
          <h4>Sales trend</h4>
          <canvas id="scatterChart"></canvas>
        </div>
        <div>
          <h4>Site Visitors - last 10 Days</h4>
          <canvas id="lineChart"></canvas>
        </div>
        <div>
          <h4>Categories trend</h4>
          <canvas id="pieChart"></canvas>
        </div>
        <div>
          <h4>Product trend</h4>
          <canvas id="barChart"></canvas>
        </div>
      </div>
    `);

    async function fetchData(url) {
      try {
        const res = await fetch(url);
        return await res.json();
      } catch (err) {
        console.error("Error fetching", url, err);
        return null;
      }
    }

    async function updateSummary() {
      const stats = await fetchData("http://localhost:3000/dash_stats");
      if (!stats) return;

      $(".summary").eq(0).find("h2").text(stats.users || 0);
      $(".summary").eq(1).find("h2").text(stats.products || 0);
      $(".summary").eq(2).find("h2").text(stats.sales || 0);
      $(".summary").eq(3).find("h2").text(stats.profit || 0);
    }

    // ---------- Charts ----------
    async function renderPieChart() {
      const data = await fetchData("http://localhost:3000/sold_products");
      if (!data) return;

      new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
          labels: data.map(d => d.label),
          datasets: [{
            data: data.map(d => d.value),
            backgroundColor: ["#3b82f6", "#6b7280", "#10b981", "#f59e0b", "#6366f1"]
          }]
        },
        options: { legend: { position: "bottom" } }
      });
    }

    async function renderBarChart() {
      const data = await fetchData("http://localhost:3000/top_products");
      if (!data) return;

      new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
          labels: data.map(d => d.label),
          datasets: [{
            label: "Best selling products",
            data: data.map(d => d.value),
            backgroundColor: "#3b82f6"
          }]
        },
        options: { legend: { display: false } }
      });
    }

    async function renderLineChart() {
      const data = await fetchData("http://localhost:3000/visitors");
      if (!data) return;

      new Chart(document.getElementById("lineChart"), {
        type: "line",
        data: {
          labels: data.map(d => d.label),
          datasets: [{
            label: "Visitors",
            data: data.map(d => d.value),
            borderColor: "#8b5cf6",
            fill: false,
            pointBackgroundColor: "#8b5cf6"
          }]
        },
        options: { legend: { display: false } }
      });
    }

    async function renderScatterChart() {
      const data = await fetchData("http://localhost:3000/sales");
      if (!data) return;

      new Chart(document.getElementById("scatterChart"), {
        type: "scatter",
        data: {
          datasets: [{
            label: "Sales in the past 10 days",
            data: data,
            backgroundColor: "#60a5fa"
          }]
        },
        options: { legend: { display: false } }
      });
    }
    updateSummary();
    renderPieChart();
    renderBarChart();
    renderLineChart();
    renderScatterChart();
  });
</script>

  </body>
</html>
